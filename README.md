**MYCRA** (My Create React App) — это кастомный высокопроизводительный инструмент для сборки, разработки и тестирования клиентских приложений, построенный на базе бандлера `esbuild`. Он предоставляет готовую конфигурацию для современных React-приложений, включая поддержку TypeScript, CSS Modules, SCSS, SVG-спрайты и многое другое.

## Ключевые фичи

  * **Скорость**: Использует `esbuild` для максимально быстрой сборки и перезагрузки.
  * **Dev-сервер**: Встроенный сервер для разработки с **Live Reload**.
  * **CSS Modules**: Продвинутая поддержка CSS-модулей с помощью проприетарного плагина `style-magic-plugin`, позволяющего использовать атрибут `styleName` в JSX.
  * **Обработка SVG**: Автоматическое создание SVG-спрайтов для оптимизации производительности. SVG, импортированные с суффиксом `?react`, преобразуются в React-компоненты.
  * **Обработка стилей**: Поддержка `SCSS` и `CSS` "из коробки", включая встраивание (inlining) локальных ресурсов (шрифтов, изображений) через `url()` в base64.
  * **Гибкая конфигурация**: Управление сборкой через параметры командной строки.
  * **Переменные окружения**: Поддержка `.env` файлов для разных режимов (`development`, `production`).

## Установка и настройка

Предполагается, что `mycra` установлен как зависимость в вашем проекте. Для использования добавьте следующие скрипты в ваш `package.json`:

```json
{
  "scripts": {
    "start": "our-scripts start",
    "build": "our-scripts build",
    "test": "our-scripts test"
  }
}
```

## Команды

### `npm start`

Запускает dev-сервер в режиме разработки.

  * Активирует `watch` режим `esbuild` для инкрементальной пересборки.
  * Поднимает локальный сервер (по умолчанию `0.0.0.0:4000`).
  * Включает Live Reload: страница автоматически перезагружается при изменениях в коде.

### `npm run build`

Собирает приложение для production.

  * Очищает директорию сборки (`dist` по умолчанию).
  * Запускает `esbuild` с настройками для production (минификация, tree-shaking).
  * Копирует файлы из папки `public` в директорию сборки.
  * Генерирует `index.html` с подключенными бандлами CSS и JS.

### `npm test`

Запускает тесты с помощью Jest.

  * Использует встроенную конфигурацию Jest.
  * По умолчанию запускается в `watch` режиме, если не указаны флаги `--ci` или `--coverage`.

## Структура проекта

Для корректной работы `mycra` рекомендуется следующая структура папок:

```
my-react-app/
├── app/
│   ├── components/
│   │   ├── Button/
│   │   │   ├── index.jsx         # Компонент Button
│   │   │   └── Button.module.scss  # Стили для компонента
│   │   └── ...
│   ├── assets/
│   │   ├── icons/
│   │   │   └── user-icon.svg     # Иконка для SVG-спрайта
│   │   └── images/
│   │       └── logo.png
│   ├── index.jsx                 # Главный входной файл приложения
│   └── index.scss                  # Глобальные стили
│
├── public/
│   ├── index.html                # HTML-шаблон
│   └── favicon.ico
│
├── .env.development              # Переменные окружения для разработки
├── .env.production               # Переменные окружения для продакшена
│
└── package.json
```

### Описание

  * `app/`: Основная папка с исходным кодом вашего приложения. Инструмент будет искать точку входа здесь (`index.js`, `index.jsx`, `index.ts`, или `index.tsx`).
  * `public/`: Папка для статичных ассетов.
      * `index.html`: **Важно\!** Этот файл должен содержать специальные комментарии-плейсхолдеры для вставки ссылок на собранные файлы:
          Для стилей: 
            ```
            <!--[styles]--> 
            ```
          Для скриптов: 
            ```
            <!--[scripts]-->
            ```
  * `.env.*`: Файлы для переменных окружения. `mycra` автоматически загрузит нужный файл в зависимости от команды (`.env.development` для `start`, `.env.production` для `build`).

## Продвинутое использование

### CSS Modules и `styleName`

Плагин `style-magic-plugin` позволяет использовать нестандартный атрибут `styleName` в JSX, что делает работу с CSS-модулями более удобной, особенно при наличии нескольких классов.

**Пример:**
`app/components/Button/Button.module.scss`

```scss
.button {
  padding: 10px 15px;
  border-radius: 4px;
  &.primary {
    background-color: blue;
    color: white;
  }
}
```

`app/components/Button/index.jsx`

```jsx
import React from 'react';
import './Button.module.scss'; // Просто импортируем стили

// Атрибут `styleName` будет автоматически преобразован в `className`
// с хешированными именами классов.
const Button = ({ isPrimary }) => {
  const buttonStyle = isPrimary ? 'button primary' : 'button';
  return <button styleName={buttonStyle}>Click me</button>;
};

export default Button;
```

Плагин автоматически найдёт импорт стилей, обработает его с помощью `postcss-modules`, а затем заменит все `styleName` в компоненте на соответствующие `className`.

### SVG-спрайты

Чтобы использовать иконку как React-компонент и добавить её в общий спрайт, импортируйте её с суффиксом `?react`.

`app/components/UserProfile/index.jsx`

```jsx
import React from 'react';
// Импорт с ?react
import UserIcon from '../../assets/icons/user-icon.svg?react';

const UserProfile = () => {
  return (
    <div>
      <UserIcon className="user-avatar" />
      <span>Username</span>
    </div>
  );
};
```

Это создаст единый файл `svg-insert.js`, который добавит все используемые иконки в виде `<symbol>` в тело документа один раз. Компонент `UserIcon` будет рендерить `<svg><use xlinkHref="#user-icon.svg" /></svg>`, что эффективно и производительно.

### Переменные окружения

Вы можете определять переменные в файлах `.env.*`. **Важно**: они должны начинаться с префикса `MYCRA_VAR_`.

`.env.development`

```
MYCRA_VAR_API_URL=http://localhost:3001/api
```

В коде приложения доступ к ним можно получить через глобальный объект `glob.env`:

```javascript
console.log(glob.env.API_URL); // "http://localhost:3001/api"
```

## Параметры командной строки

Вы можете кастомизировать поведение сборщика с помощью флагов. Полный список находится в `utils/args.js`.

| Аргумент              | Алиас | Описание                                                                  | По умолчанию      |
|-----------------------|--------|---------------------------------------------------------------------------|-------------------|
| `path`                | `p`    | Путь к папке с исходным кодом приложения.                                 | `'app'`           |
| `outputDir`           | `d`    | Папка для скомпилированных файлов.                                        | `'dist'`          |
| `public`              | `pb`   | Папка для статичных файлов.                                               | `'public'`        |
| `template`            | `t`    | Имя HTML-шаблона в папке `public`.                                        | `'index.html'`    |
| `devServer`           | `ds`   | Флаг для запуска dev-сервера (неявно используется в `start`).             | `false`           |
| `size`                | `s`    | Показать размер бандла после сборки с помощью `size-limit`.               | `false`           |
| `coverage`            | `c`    | Сгенерировать отчёт о покрытии тестами.                                   | `false`           |
| `ci`                  |        | Запустить тесты в режиме CI (без `watch` режима).                         | `false`           |
| `source-map`          | `sm`   | Форсировать генерацию `inline-source-map`.                                | `false`           |
| `format`              | `f`    | Формат выходных файлов (`esm`, `cjs`, `iife`).                            | `'esm'`           |
| `babel`               | `b`    | Путь к файлу с конфигурацией Babel для `esbuild-plugin-babel`.            | `''`              |
| `excludeModules`      | `em`   | Исключить `node_modules` из бандла (режим `external`).                    | `false`           |

-----

